function buildBrowserPush(e,t,n){function i(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(n),r=new Uint8Array(i.length),a=0;a<i.length;++a)r[a]=i.charCodeAt(a);return r}function r(e,t,n){return new e.constructor(function(e,i){if(!t)return void i("Active worker not found.");var r=new MessageChannel;r.port1.onmessage=function(t){if(t.data.error)return i(t.data.error);try{e(JSON.parse(t.data))}catch(n){i("Malformed response")}},t.postMessage(g+JSON.stringify(n||{}),[r.port2])})}function a(e,t){return new e.constructor(function(n,i){return t.active||i("Error no active registration."),r(e,t.active).then(function(e){return e&&e.events?(e.events.forEach(function(e){window.Kahuna.trackEventWithOptions(e)}),void n(t)):void i("Unable to register the BrowserPush ServiceWorker")})["catch"](function(){i("Error sending message to BrowserPush ServiceWorker.")})})}function o(e){return window.btoa(JSON.stringify(e))}function s(e,t,n,i){var r=t&&{scope:t}||void 0,s=navigator.serviceWorker.register(e,r);return s.then(function(t){return new s.constructor(function(n,i){return t.active?void n(t):void(t.onupdatefound=function(){if(t.active)return void n(t);var r=t.installing||t.waiting;r&&(r.onstatechange=function(e){return"activated"===e.target.state?t.active?n(t):i("Controller unavailable"):void 0}),window.setTimeout(function(){navigator.serviceWorker.getRegistration(e).then(function(e){return e.active?n(e):i("5 second timeout reached waiting for ServiceWorker to install.")})},5e3)})})}).then(function(e){return a(s,e)}).then(function(e){return e.pushManager.getSubscription().then(function(t){return t?(i(o(t)),e):e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n}).then(function(t){return i(o(t)),e})})})["catch"](function(e){window.Kahuna.logError(e)})}function u(e,t){navigator.serviceWorker.getRegistrations().then(function(n){n.forEach(function(n){var i=n.active||n.installing||n.waiting,r=i&&i.scriptURL;if(r){var a=r.slice(r.length-e.length),o=a===e,s=!t||r.indexOf(t)>=0;o&&s&&n.unregister()}})})}function l(){this._isInitialized=!1,this._applicationServerKey=i("BFmh_GGD8yclsABI5K1rdNyfb7kWwSwZ3HDaKXW13ldrriiRDvSy8f3ND5Ry5FA05aFgNCBk0eEFytzCbsJZe1Q")}if(window.Kahuna.BrowserPush)return window.Kahuna.BrowserPush;var g="[KAHUNA]";return l.Status={BLOCKED:"BLOCKED",UNAVAILABLE:"UNAVAILABLE",GRANTED:"GRANTED",ERROR:"ERROR",PENDING:"PENDING"},l.prototype.init=function(e,n){if(this._isInitialized)return window.Kahuna.logError("Kahuna.BrowserPush is already initialized."),null;this._isInitialized=!0;var i=null;i=ServiceWorkerRegistration&&"showNotification"in ServiceWorkerRegistration.prototype?"granted"!==Notification.permission&&"blocked"!==Notification.permission?l.Status.PENDING:"granted"===Notification.permission?l.Status.GRANTED:l.Status.BLOCKED:l.Status.UNAVAILABLE,this._status=i,this._webWorkerUrl=e,this._scope=n,this._controller=null;var r=function(e){this._pushToken=e,t(e)}.bind(this),a=this;i===l.Status.PENDING?this._readyPromise=Notification.requestPermission().then(function(t){return new a._readyPromise.constructor(function(i,r){"granted"!==t?(a._status=l.Status.BLOCKED,u(e,n),r()):(a._status=l.Status.GRANTED,i())})}).then(function(){return a._status===l.Status.GRANTED?s(e,n,a._applicationServerKey,r):void 0}):i===l.Status.GRANTED?this._readyPromise=s(e,n,a._applicationServerKey,r):u(e,n)},l.prototype.isInitialized=function(){return this._isInitialized},l.prototype.ready=function(e){return this._isInitialized&&this._readyPromise&&this._status!==l.Status.ERROR?void this._readyPromise.then(function(){e(!0)})["catch"](function(){e(!1)}):void e(!1)},l.prototype.flushEvents=function(e){var t=e||function(){};if(!this._isInitialized||!this._readyPromise||this._status===l.Status.ERROR)return void t();var n=function(e){return a(this._readyPromise,e)}.bind(this);this._readyPromise.then(n).then(t)["catch"](function(){t()})},l.prototype.subscribe=function(){var e=n();this._pushToken&&this._pushToken!==e&&(window.Kahuna.trackEvent("k_push_enabled"),e||t(this._pushToken))},l.prototype.unsubscribe=function(){t(null),window.Kahuna.trackEvent("k_push_disabed")},window.Kahuna.BrowserPush||new l}if(Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var i,r=parseInt(arguments[1],10)||0;r>=0?i=r:(i=n+r,0>i&&(i=0));for(var a;n>i;){if(a=t[i],e===a||e!==e&&a!==a)return!0;i++}return!1}),function(){"use strict"}(),"undefined"==typeof Kahuna)var Kahuna=function(){function e(){var e={dev_id:G,os_name:D,os_version:N,dev_name:L,app_name:j,app_ver:U,sdk_version:z,key:P};return W&&(e.push_token=W),e}function t(e){W=e,e?document.cookie="kahuna_push_token="+e+"; expires=Thu, 2 Aug 3001 20:47:11 UTC; path=/":document.cookie="kahuna_push_token=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;"}function n(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function i(e){return e&&"string"==typeof e&&e.length>0?!0:!1}function r(){for(var e=24,t="abcdefghijklnopqrstuvwxyz0123456789",n="",i=0,r=t.length;e>i;++i)n+=t.charAt(Math.floor(Math.random()*r));return n}function a(e){return window.btoa(encodeURIComponent(e))}function o(e){return decodeURIComponent(window.atob(e))}function s(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(e){return!1}}function u(e){var t=new Date;e=e||t;var n=""+e.getFullYear(),i=""+(e.getMonth()+1);1==i.length&&(i="0"+i);var r=""+e.getDate();1==r.length&&(r="0"+r);var a=""+e.getHours();1==a.length&&(a="0"+a);var o=""+e.getMinutes();1==o.length&&(o="0"+o);var s=""+e.getSeconds();1==s.length&&(s="0"+s);var u=""+e.getMilliseconds();return u.length<3&&(u="0"+u),u.length<3&&(u="0"+u),n+"-"+i+"-"+r+" "+a+":"+o+":"+s+"."+u}function l(e){ee&&ge.log("[Kahuna] ["+u()+"] DEBUG: "+e)}function g(e){ee&&ge.log("[Kahuna] ["+u()+"] ERROR: "+e)}function c(e){try{if(null==e||""===e)return!1;var t=d();if(""===t)t=e;else{if(t.length>56e3)return!1;t=t+","+e}var n=JSON.parse("["+t+"]").length;t=a(t),sessionStorage.setItem("kahuna.js.sdk.events",t),l("Events in Queue: "+n+"; maxQueue: "+q.n),n>=q.n&&b({n:q.n})}catch(i){return!1}return!0}function d(){var e=sessionStorage.getItem("kahuna.js.sdk.events");return null==e||""===e?"":(e=o(e),"{"!=e.charAt(0)||"}"!=e.charAt(e.length-1)?(p(),""):e)}function p(){sessionStorage.removeItem("kahuna.js.sdk.events")}function h(){if(!re)return 0;try{var e="kahuna.js.sdk.eventnumber."+G,t=Number(localStorage.getItem(e)||0)+1;return localStorage.setItem(e,t),t}catch(n){return 0}}function f(){localStorage.removeItem("kahuna.js.sdk.eventnumber."+G)}function v(){q.v?te||(te=setTimeout(function(){b({t:q.t})},1e3*q.t*60)):b({install:(new Date).getTime()/1e3})}function m(e){ne||(ne=setTimeout(function(){b(e)},1e3*q.fsd*60))}function b(e){ie&&clearTimeout(ie),ie=setTimeout(function(){y(e)},1e3)}function y(e){var t=e?JSON.stringify(e):"";l("Flushing Events. Reason: "+t),w();var n=d();if(lastFlushDate=new Date,""!==n){p();var i;i="["+n+"]";var r=JSON.parse(i),a=r.length;Math.min(q.b,a);a>q.b,l("Flush Reason: "+t+"; Events: "+i);var o=O+(e?(O.indexOf("?")>0?"&":"?")+"flush_reason="+encodeURIComponent(t):"");ce.get(o,i,function(t){Kahuna.BrowserPush.flushEvents();var i=t.success?!0:!1;if(!i){l("Kahuna SDK call failure. Retrying shortly.");var r=d();p(),c(n+(r?",":"")+r),b(e)}if(S(t),"object"==typeof t.sdk_iam&&Kahuna.RichInAppMessageManager){l("Trying to render a Rich IAM");var a=t.sdk_iam;Kahuna.RichInAppMessageManager.handleRichInAppMessageResponse(a)}else t.iam_available||"object"==typeof t.sdk_iam?(l("IAM Available"),E({callback:function(e){try{if("object"==typeof e.sdk_iam&&Kahuna.RichInAppMessageManager){l("Trying to render a Rich IAM");var t=e.sdk_iam;Kahuna.RichInAppMessageManager.handleRichInAppMessageResponse(t)}if("undefined"!=typeof e.iam){var n="",i=null,r={};for(var a in e.iam){var o=e.iam[a];"undefined"!=typeof o&&("k_m"==a?n=o:"k_t"==a?i=o:"k_c"!=a&&(r[a]=o))}var s={message:n,expiration:i,additionalParameters:r,read:!1};x(s)&&(E({callback:function(e){},confirmReceipt:!0,inAppTimestamp:i}),_())}}catch(u){g(u.message)}}})):_()})}}function k(){var e=n("kahuna_in_app_message");if(!e||"to_be_delete"===e)return null;try{return JSON.parse(e)}catch(t){return g(t.message),null}}function x(e){if(!e||"undefined"==typeof e.message||"undefined"==typeof e.expiration)return!1;var t=k();if(t&&t.message===e.message&&t.expiration===e.expiration)return!0;try{var n=new Date;return n.setDate(n.getDate()+30),document.cookie=["kahuna_in_app_message","=",ue.stringify(e),"; expires="+n.toUTCString()].join("")}catch(i){return g(i.message),null}}function A(){var e=k();if(!e)return!1;e.read=!0;try{var t=new Date;return t.setDate(t.getDate()+30),document.cookie=["kahuna_in_app_message","=",ue.stringify(e),"; expires="+t.toUTCString()].join("")}catch(n){return g(n.message),null}}function I(){try{var e=new Date;return e.setDate(e.getDate()-30),document.cookie=["kahuna_in_app_message","=","to_be_delete","; expires="+e.toUTCString()].join("")}catch(t){return g(t.message),!1}}function _(){try{var e=k();if(null!==e&&0==e.read){var t=new Date,n=new Date;if(n.setUTCSeconds(t.expiration),t>=n)return void I();var i={message:e.message,additionalParameters:e.additionalParameters};"function"==typeof V&&V(i)}}catch(r){return g(r.message),!1}}function w(){te&&(clearTimeout(te),te=null),ne&&(clearTimeout(ne),ne=null)}function R(e){re=!!e}function S(e){e.c&&e.c.v&&e.c.v!==q.v&&(l("Updating configuration from version ["+q.v+"] to version ["+e.c.v+"]"),q=JSON.parse(JSON.stringify(e.c)),te&&(clearTimeout(te),v()),(!q.b||q.b>q.n)&&(q.b=q.n),q.wsd||(q.wsd=H),configurationStr=ue.stringify(q),l(configurationStr),localStorage.setItem("kahuna.js.sdk.configuration",configurationStr))}function E(e){var t=[];t.push("dev_id="+encodeURIComponent(n("kahuna_dev_id"))),t.push("key="+P),t.push("env="+$),t.push("sdk_version="+z),e.confirmReceipt&&e.inAppTimestamp&&(t.push("confirm_receipt=true"),t.push("in_app_timestamp="+e.inAppTimestamp)),ce.fetch(K+"?"+t.join("&"),e.callback)}function C(e){}function T(e,t){le[e]||(le[e]=[]),le[e].push(t),window.addEventListener(e,t),l("Handler registered for "+e)}function B(){for(var e in le){for(var t=le[e],n=0;n<t.length;n++)window.removeEventListener(e,t[n]),l("Handler removed for "+e);delete le[e]}}var M,O="https://tap-nexus.appspot.com/log",K="https://tap-nexus.appspot.com/iamw",P="",D="",N="",j="",U="",G="",L="",z="2.3.0",W="",Y=!1,F=!1,J=!1,$="",V=null,H=14400,q={v:0,t:30,n:100,fsd:5,fi:["start","k_user_login","k_user_logout","k_app_bg"],fs:[],wsd:H},X=localStorage.getItem("kahuna.js.sdk.configuration");if(X)try{q=JSON.parse(X)}catch(Q){}var Z=["sdk_iam"],ee=!1,te=null,ne=null,ie=null,re=!1,ae=!1,oe=!1,se=!1,ue=null,le={};"undefined"==typeof JSON||"function"!=typeof JSON.stringify?(ue={},ue.stringify=function(e){var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,i,r=[],a=e&&e.constructor==Array;for(n in e)i=e[n],t=typeof i,"string"==t?i='"'+i.replace(/"/g,'\\"')+'"':"object"==t&&null!==i&&(i=ue.stringify(i)),r.push((a?"":'"'+n+'":')+String(i));return(a?"[":"{")+String(r)+(a?"]":"}")}):ue=JSON;var ge={};"undefined"==typeof console?(ge={},ge.log=function(){}):ge=console;var ce=function(){function t(e){var t=document.createElement("script"),n=!1;t.src=e,t.async=!0,t.onload=t.onreadystatechange=function(){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!0,t.onload=t.onreadystatechange=null,t&&t.parentNode&&t.parentNode.removeChild(t))},l||(l=document.getElementsByTagName("head")[0]),l.appendChild(t)}function n(e){return encodeURIComponent(e)}function a(e,t,n){var i=t;return d[i]=function(e){"function"==typeof n&&n(e);try{delete d[i]}catch(t){}d[i]=null},this.load(e+'&callback=window["'+i+'"]'),i}function o(e,t){a.call(this,e,"json"+r(),t)}function s(t,o,s){g=-1===(t||"").indexOf("?")?"?":"&";var u="json"+r();return Kahuna.BrowserPush.ready(function(){var r=e();r.events=o,r.fsupported=JSON.stringify(Z),("p"==$||"s"==$)&&(r.env=$),i(M)&&(r.app_type=M),g+=n("client_time")+"="+n((new Date).getTime()/1e3)+"&";for(c in r)r.hasOwnProperty(c)&&(g+=n(c)+"="+n(r[c])+"&");return a.call(this,t+g,u,s)}.bind(this)),u}function u(e){p=e}var l,g,c,d=this,p={};return{load:t,get:s,init:u,fetch:o}}();return{jsonp:ce,init:function(a,o,u,c){try{J&&(B(),J=!1,P=null,l("UNINIT")),P=a;var d=n("kahuna_native_client");if(i(d)){F=!0,d=decodeURIComponent(d);for(var p=[],h=d.split("&"),v=0;v<h.length;v++){var m=h[v].split("=");p.push(m[0]),p[m[0]]=m[1]}D=i(p.os_name)?p.os_name:BrowserDetect.browser,N=i(p.os_version)?p.os_version:BrowserDetect.version+" ("+BrowserDetect.OS+")",j=i(p.app_name)?p.app_name:o,U=i(p.app_ver)?p.app_ver:u,M="cookie_injection",L=i(p.dev_name)?p.dev_name:"website",i(p.dev_id)&&"(null)"!==p.dev_id?G=p.dev_id:(G=n("kahuna_dev_id"),G||(G=r(),document.cookie="kahuna_dev_id="+G+"; expires=Thu, 2 Aug 3001 20:47:11 UTC; path=/",f(),sessionStorage.removeItem("kahuna.js.sdk.creds"),localStorage.removeItem("kahuna.js.sdk.deviceloggedin")))}else D=BrowserDetect.browser,N=BrowserDetect.version+" ("+BrowserDetect.OS+")",j=o,U=u,L="website",G=n("kahuna_dev_id"),G||(G=r(),document.cookie="kahuna_dev_id="+G+"; expires=Thu, 2 Aug 3001 20:47:11 UTC; path=/",f(),sessionStorage.removeItem("kahuna.js.sdk.creds"),localStorage.removeItem("kahuna.js.sdk.deviceloggedin"));W=n("kahuna_push_token"),V=c,_(),Y=s(),T("beforeunload",function(){try{Kahuna.flushEventsNow({fi:"beforeUnload"})}catch(e){}}),l("REGISTERING EVENT HANDLERS"),this.BrowserPush=buildBrowserPush(e(),t,n.bind(null,"kahuna_push_token")),J=!0}catch(b){g(b.message)}},uninit:function(){B()},k:function(e){1==e&&(O="/log",K="/iamw")},setOfflineMode:function(e){se=e||!1},callbacks:function(){},requireCredentials:function(e,t){ae=!!e,t=!!t},setDebugMode:function(e){ee=!!e},getDebugModeEnabled:function(){return ee===!0},enableTriggerCampaigns:function(e){R(!!e)},getTriggerCampaignsEnabled:function(){return re},trackEvent:function(e,t,n){try{if(F&&"start"===e)return;t=t||-1,n=n||-1;var i={};i.event=e,t>-1&&n>-1&&(i.count=t,i.value=n),this.trackEventWithOptions(i)}catch(r){g(r.message)}},track:function(e){if(e&&e.constructor==KahunaEvent){if(F&&"start"===eventBuilder.eventName)return;var t=e.count||-1,n=e.value||-1,i={};i.event=e.eventName,t>-1&&n>-1&&(i.count=t,i.value=n),e.properties&&Object.keys(e.properties).length>0&&(i.properties=e.getPropertiesAsMap()),this.trackEventWithOptions(i)}else g("passed in parameter is null or is not of type KahunaEvent")},trackEventWithOptions:function(e){try{if(J||g("You must call init first."),!e)return void g("You must specify a dictionary of options.");var t=e.event||null;if(!t||""==t)return void g("A valid event name in the options dictionary.");var n=e.count||-1,i=e.value||-1,r=e.time||(new Date).getTime()/1e3;if("start"==t.toLowerCase()){var a=(new Date).getTime(),o=new Date(Number(sessionStorage.getItem("kahuna.js.sdk.starteventtime"))||a);if(sessionStorage.setItem("kahuna.js.sdk.starteventtime",a),q.wsd&&a-o<1e3*q.wsd)return void g("Start event called too frequently. Not sending.")}var s="k_app_bg"!=t?h():0;if(!P||""===P)return void g("Event not logged. Invalid key.");var u="",d={};d.event=t,d.time=r,s&&(d.event_number=s),e.hasOwnProperty("credentials")&&(d.credentials=e.credentials),e.hasOwnProperty("properties")&&(d.properties=e.properties),n>-1&&i>-1?(d.count=n,d.value=i):e.hasOwnProperty("user_info")&&(d.user_info=e.user_info),u=ue.stringify(d),"k_user_logout"==t?c(u):ae&&!localStorage.getItem("kahuna.js.sdk.deviceloggedin")?oe&&W?c(u):l("Credentials required. Not sending events."):"k_app_bg"!=t&&c(u),-1!=q.fs.indexOf(t.toLowerCase())?m({fs:t.toLowerCase()}):-1!=q.fi.indexOf(t.toLowerCase())&&b({fi:t.toLowerCase()}),v()}catch(p){g(p.message)}},createUserCredentials:function(){return new KahunaUserCredentials},login:function(e){try{if(!P||""===P)return void g("Event not logged. Invalid key. ");var t={};if(t.event="k_user_login","undefined"!=typeof e&&!e.isEmpty()){t.credentials=e.getCredentialsAsMap();var n=(new Date).getTimezoneOffset(),i=Math.abs(n),r="GMT"+(0>n?"+":"-")+("00"+Math.floor(i/60)).slice(-2)+":"+("00"+i%60).slice(-2),a=document.documentElement.lang;a||(a=document.getElementsByTagName("html")[0].getAttribute("lang")),a&&(a=a.split("-")[0]),t.user_info={},t.user_info.kahuna_tz=r,a&&(t.user_info.kahuna_lang=a)}var o=JSON.stringify(t);sessionStorage.getItem("kahuna.js.sdk.creds")!=o?(sessionStorage.setItem("kahuna.js.sdk.creds",o),localStorage.setItem("kahuna.js.sdk.deviceloggedin","true"),this.trackEventWithOptions(t)):l("Saved credentials are not modified. Not resending.")}catch(s){g(s.message)}},setUserCredentials:function(e,t,n,i,r,a){try{if(!P||""===P)return void g("Event not logged. Invalid key.");var o={};e&&(o.username=[e]),t&&(o.email=[t]),n&&(o.fbid=[n]),i&&(o.twtr=[i]),r&&(o.lnk=[r]),a&&(o.user_id=[a]);var s=o,u={};u.event="k_user_credentials",u.credentials=s,this.trackEventWithOptions(u)}catch(l){g(l.message)}},setCustomCredentials:function(e){try{if(!P||""===P)return void g("Event not logged. Invalid key.");var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=[e[n]]);var i=t,r={};r.event="k_user_credentials",r.credentials=i,this.trackEventWithOptions(r)}catch(a){g(a.message)}},logout:function(){try{if(sessionStorage.removeItem("kahuna.js.sdk.creds"),localStorage.removeItem("kahuna.js.sdk.deviceloggedin"),!P||""===P)return void g("Event not logged. Invalid key.");var e={};e.event="k_user_logout",this.trackEventWithOptions(e)}catch(t){g(t.message)}},background:function(){try{if(!P||""===P)return void g("Event not logged. Invalid key.");var e={};e.event="k_app_bg",Kahuna.trackEventWithOptions(e),this.trackEventWithOptions(e)}catch(t){g(t.message)}},setUserAttributes:function(e){try{if(!P||""===P)return void g("Event not logged. Invalid key.");if(0==Object.keys(e).length)return void g("setUserAttributes called with no values.");var t=e,n={};n.event="k_user_attributes",n.user_info=t,this.trackEventWithOptions(n)}catch(i){g(i.message)}},clearUserAttributes:function(){g("clearUserAttributes() Deprecated")},setEnvironment:function(e){$=e},setInAppMessageCallBack:function(e){V=e},dismissInAppMessage:function(){A()},checkInAppMessage:function(){_()},flushEvents:function(e){b(e)},flushEventsNow:function(e){y(e)},getLastBatchSentDate:function(){return lastFlushDate},getConfiguration:function(){return q},enableAutomatedCollection:function(e){C(!!e)},hashChange:function(){var e=new KahunaEventBuilder("URL hash changed");e.addProperty("url",window.location.href),e.addProperty("baseurl",window.location.href.split("#")[0]),e.addProperty("hash",window.location.hash),Kahuna.track(e.build())},logDebug:function(e){l(e)},logError:function(e){g(e)},updateEventSettings:function(e){S(e)}}}();var KahunaEventBuilder=function(e){this.eventName=e,this.properties={},this.count=-1,this.value=-1,this.setPurchaseData=function(e,t){this.count=e,this.value=t},this.addProperty=function(e,t){if(e&&t&&"string"==typeof e&&"string"==typeof t&&e.length>0&&t.length>0)if(0==e.trim().toLowerCase().indexOf("k_"))logDebug("Warning: key starts with k_ is considered reserved keys.");else{var n=this.properties[e]||{};n[t]=!0,this.properties[e]=n}},this.build=function(){var e=new KahunaEvent;return e.count=this.count,e.value=this.value,e.eventName=this.eventName,e.properties=this.properties,e}};KahunaEventBuilder.EVENT_PROPERTIES_MAX_COUNT=25;var KahunaEvent=function(){this.eventName,this.properties={},this.count=-1,this.value=-1,this.getPropertiesAsMap=function(){if(null!=this.properties&&Object.keys(this.properties).length>0){var e={};for(var t in this.properties)if(this.properties.hasOwnProperty(t)&&(e[t]=Object.keys(this.properties[t]),Object.keys(e).length===KahunaEventBuilder.EVENT_PROPERTIES_MAX_COUNT))break;return e}}},KahunaUserCredentials=function(){this.USERNAME_KEY="username",this.EMAIL_KEY="email",this.FACEBOOK_KEY="fbid",this.TWITTER_KEY="twtr",this.LINKEDIN_KEY="lnk",this.USER_ID_KEY="user_id",this.INSTALL_TOKEN_KEY="install_token",this.GOOGLE_PLUS_ID="gplus_id",this.credentialsMap={},KahunaUserCredentials.prototype.add=function(e,t){if(e&&t){var n=this.credentialsMap[e];void 0==n&&(n={}),n[t]=!0,this.credentialsMap[e]=n}},KahunaUserCredentials.prototype.getCredentialsAsMap=function(){if(null!=this.credentialsMap){var e={};for(var t in this.credentialsMap)e[t]=Object.keys(this.credentialsMap[t]);return e}},KahunaUserCredentials.prototype.isEmpty=function(){return 0==Object.keys(this.credentialsMap).length}},BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||navigator.appName||"unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||navigator.appVersion||"unknown version",this.OS=this.searchString(this.dataOS)||"unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,i=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(i)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"CriOS",identity:"Chrome",versionSearch:"CriOS"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init(),window.addEventListener("beforeunload",function(){try{Kahuna.flushEventsNow({fi:"onbeforeunload"})}catch(e){}});var Color=function(){function e(e,t,n,i){return(e<<24)+(t<<16)+(n<<8)+i}function t(e){try{return Number.isInteger(e)?0>e?!1:e>255?!1:!0:!1}catch(t){return!1}}function n(n){if(null==n)return null;if("number"!=typeof n.r)return null;if("number"!=typeof n.g)return null;if("number"!=typeof n.b)return null;if("number"!=typeof n.a)return null;var i=n.a,r=n.r,a=n.g,o=n.b;return t(r)&&t(a)&&t(o)&&t(i)?e(i,r,a,o):null}function i(e){if(null===e)return null;if("number"==typeof e){var t="",n=e>>16&255,r=e>>8&255,a=255&e;return t+=(15>=n?"0":"")+n.toString(16).toUpperCase(),t+=(15>=r?"0":"")+r.toString(16).toUpperCase(),t+=(15>=a?"0":"")+a.toString(16).toUpperCase(),"#"+t}return"object"==typeof e?i(Color.getIntColorFromColorObject(e)):void 0}return{getIntColorFromColorObject:function(e){return n(e)},getRGB:function(e){return i(e)},argb:function(t,n,i,r){return e(t,n,i,r)},WHITE:e(255,255,255,255),BLACK:e(255,0,0,0),RED:e(255,255,0,0),GREEN:e(255,0,255,0),BLUE:e(255,0,0,255),CYAN:e(255,0,255,255),DKGRAY:e(255,68,68,68),GRAY:e(255,136,136,136),LTGRAY:e(255,204,204,204),MAGENTA:e(255,255,0,255),TRANSPARENT:e(0,0,0,0),YELLOW:e(255,255,255,0)}}();!function(){var e=function(){function e(e,t){this.text=e?e:null,this.textColorAsRGB=t?t:null,this.getText=function(){return this.text},this.getTextColorAsRGB=function(){return this.textColorAsRGB}}return{parseRichInAppMessageText:function(t){if(null!==t&&0!=Object.keys(t).length){var n=t.text||"";if(""!=n){var i="#000000";if("undefined"!=typeof t.color&&(i=Color.getRGB(t.color)),null!=i)return new e(n,i)}}return Kahuna.logDebug("Invalid Rich In App Text object: "+JSON.stringify(t)),null}}}(),t=function(){function t(e,t,n,i,r,a,o,s,u,l){this.id=e,this.type=t,this.subtype=n,this.fallbackSubtype=i,this.title=r,this.message=a,this.buttons=o,this.backgroundColorAsInt=s,this.images=u,this.attributes=l,this.getId=function(){return this.id},this.getType=function(){return this.type},this.getSubtype=function(){return this.subtype},this.getFallbackSubtype=function(){return this.fallbackSubtype},this.getTitle=function(){return this.title},this.getMessage=function(){return this.message},this.getBackgroundColorAsInt=function(){return this.backgroundColorAsInt},this.getBackgroundColorAsRGB=function(){return Color.getRGB(this.backgroundColorAsInt)},this.getButtons=function(){return this.buttons},this.getImages=function(){return this.images}}function r(e,r,a,o,s,u,l){this.id=e,this.type=r,this.subtype=a,this.title=o,this.message=s,this.buttons={};var g=Object.keys(u);for(var c in g){var d=g[c];this.buttons[d]=i.parseRichInAppMessageButton(d,u[d])}this.images={};var p=Object.keys(l);for(var c in p){var h=p[c];this.images[h]=n.parseRichInAppMessageImage(l[h])}this._fallbackSubtype=null,this._backgroundColorAsInt=Color.WHITE,this.fallbackSubtype=function(e){return this._fallbackSubtype=e,this},this.backgroundColorAsInt=function(e){return this._backgroundColorAsInt=e,this},this.build=function(){return new t(this.id,this.type,this.subtype,this._fallbackSubType,this.title,this.message,this.buttons,this._backgroundColorAsInt,this.images,this.attributes)}}return{parseRichInAppMessageTemplate:function(t){var n=null;if("undefined"!=typeof t&&null!=t){if("undefined"==typeof t.templateId||"undefined"==typeof t.type||"undefined"==typeof t.subtype)return null;var i=t.templateId,a=t.type,o=t.subtype;if(null==o&&(o=-1),i&&a&&o>=0){var s=t.fallback_subtype;null==s&&(s=-1);var u=e.parseRichInAppMessageText(t.title||{}),l=e.parseRichInAppMessageText(t.message||{}),g=Color.WHITE;"undefined"!=typeof t.bgcolor&&(g=Color.getIntColorFromColorObject(t.bgcolor));var c=(t.attributes,t.images||{});if(null==c)return null;var d=t.buttons||{};if(null==d)return null;null!=l&&null!=g&&d&&0!=Object.keys(d).length&&(templateBuilder=new r(i,a,o,u,l,d,c),templateBuilder.fallbackSubtype(s),templateBuilder.backgroundColorAsInt(g),n=templateBuilder.build())}}return n}}}(),n=function(){function e(e){this.url=e,this.getImageUrl=function(){return this.url},this.setBitMap=function(e){return null},this.getBitMap=function(){return null}}return{parseRichInAppMessageImage:function(t){return t&&0!=Object.keys(t).length&&(url=t.url,url)?new e(url):null}}}(),i=function(){function e(e,t,n,i,r,a){this.key=e,this.text=t,this.action=n,this.actionValue=i,this.textColorAsInt=r,this.backgroundColorAsInt=a,this.getKey=function(){return this.key},this.getText=function(){return this.text},this.getAction=function(){return this.action},this.getActionValue=function(){return this.actionValue},this.getTextColorAsInt=function(){return this.textColorAsInt},this.getTextColorAsRGB=function(){return Color.getRGB(this.textColorAsInt)},this.getBackgroundColorAsInt=function(){return this.backgroundColorAsInt},this.getBackgroundColorAsRGB=function(){return Color.getRGB(this.backgroundColorAsInt)}}return{parseRichInAppMessageButton:function(t,n){if(n&&Object.keys(n).length>0&&"string"==typeof n.text){var i=n.text,r=null,a=null;if(n.action){var o=n.action;o&&Object.keys(o).length>0&&(void 0!==o.close?r="close":void 0!==o.url&&(r="url",a=o.url))}var s=Color.BLACK,u=Color.WHITE;if(void 0!==n.color&&(s=Color.getIntColorFromColorObject(n.color)),void 0!==n.bgcolor&&(u=Color.getIntColorFromColorObject(n.bgcolor)),null!=s&&null!=u&&null!=r)return new e(t,i,r,a,s,u)}return null}}}(),r=function(){function e(e,t,i,r){if(this.message=null,this.renderAttempts=3,this.expireTime=null,this.restrictedCredentials=null,this.state=n.UNPREPARED,this.templates=[],this.trackingId=e,this.templates=t,i>-1)this.expireTime=i;else{var o=new Date;o.setSeconds(o.getSeconds()+a.DEFAULT_EXPIRY_SECONDS),this.expireTime=o}this.restrictedCredentials=r,this.getTrackingId=function(){return this.trackingId},this.getExpireTime=function(){return this.expireTime},this.getRestrictedCredentials=function(){return this.restrictedCredentials},this.getTemplates=function(){return this.templates},this.getRetryAttempts=function(){return this.renderAttempts},this.decrementRetryAttempt=function(){this.renderAttempts--},this.setPreparing=function(){this.state=n.PREPARING},this.setPrepared=function(){this.state=n.PREPARED},this.setUnprepared=function(){this.state=n.PREPARED},this.getState=function(){return this.state}}var n={UNPREPARED:0,PREPARING:1,PREPARED:2};return{parseRichInAppMessage:function(n){var i=null;if(n&&Object.keys(n).length>0){var r=n.trackingId,a=n.expiry||-1,o=n.creds;if(r){var s=n.templates,u=new Array;if(s&&Object.keys(s).length>0)for(var l=0;l<s.length;l++){var g=s[l],c=t.parseRichInAppMessageTemplate(g);if(!c)return null;u.push(c)}if(!(u.length>0))return null;i=new e(r,u,a,o)}}return i},State:n}}(),a=function(){function e(){return null==M&&(M=a),M}function t(e){O=e}function n(t,n){function i(){var i=n.getTemplates(),r=i[0],a=r.getType().toLowerCase(),o=r.getSubtype();g(r,a,o)||(o=r.getFallbackSubtype(),g(r,a,o)||(a=y,o=1));var s={button1:{display:"none"},button2:{display:"none"},image1:{display:"none"},image2:{display:"none"},closeButton:{display:"none"},title:{display:"none"},message:{display:"none"},background:{display:"none","z-index":99999},backgroundPre:{opacity:0},backgroundPost:{opacity:1},backgroundClose:{opacity:0},modalPanel:{opacity:.4,cursor:"not-allowed",position:"fixed",left:"0px",top:"0px","background-color":"#000000",width:$(document).width(),height:$(document).height()}},u=500,l=!1;if(I.includes(a)){d(t,!1),Kahuna.logDebug("Laying out in-app Message: "+a+"--"+o);var c='"LatoLatinWeb","Lato","AvenirNext-Regular","AvenirNextLTW01-Regular","Avenir Next","Avenir","Segoe UI","Arial","sans-serif"';if(k==a&&_.includes(o)){var h=r.getButtons().button1;h&&(s.button1={color:h.getTextColorAsRGB(),"background-color":h.getBackgroundColorAsRGB(),width:"154px",height:"54px","line-height":"54px","text-align":"center","font-family":c,"font-size":"16px",border:"none","border-radius":"4px","box-shadow":"0px 2px 5px 0px rgba(0, 0, 0, 0.5)",display:"inline-block",margin:"10px"}),h=r.getButtons().button2,h&&(s.button2={color:h.getTextColorAsRGB(),"background-color":h.getBackgroundColorAsRGB(),width:"154px",height:"54px","line-height":"54px","text-align":"center","font-family":c,"font-size":"16px",border:"none","border-radius":"4px","box-shadow":"0px 2px 5px 0px rgba(0, 0, 0, 0.5)",display:"inline-block",margin:"10px"}),r.getImages().image1&&(s.image1={width:"100%",padding:"0px",margin:"0px","line-height":"0px"}),r.getImages().image2&&(s.image2={width:"100%",padding:"0px",margin:"0px","line-height":"0px"}),s.title={color:r.getTitle().getTextColorAsRGB(),padding:"10px","font-size":"24px","font-family":c,"text-align":"center"},s.message={color:r.getMessage().getTextColorAsRGB(),padding:"10px","padding-left":"30px","padding-right":"30px;","font-size":"13px","text-align":"left","font-family":c},s.background={"background-color":r.getBackgroundColorAsRGB(),padding:"0px",width:"360px",position:"fixed",top:"30px",border:"1px solid darkgray",left:($(window).width()-480)/2+"px","box-shadow":"0px 5px 5px 0px rgba(0, 0, 0, 0.5)","z-index":99999,cursor:"default"},l=!0}else if(x==a&&w.includes(o)||y==a){Kahuna.logDebug(JSON.stringify(r));var h=r.getButtons().button1;h&&(s.button1={"background-color":h.getBackgroundColorAsRGB(),
color:h.getTextColorAsRGB(),"border-collapse":"collapse","border-top":"1px solid #545e6b",width:"147px",height:"53px","line-height":"53px","font-size":"16px","text-align":"center","font-family":c,display:"inline-block",margin:"0px"}),h=r.getButtons().button2,h&&(s.button2={"background-color":h.getBackgroundColorAsRGB(),color:h.getTextColorAsRGB(),"border-collapse":"collapse","border-top":"1px solid #545e6b","border-left":"1px solid #545e6b",width:"147px",height:"53px","line-height":"53px","font-size":"16px","text-align":"center","font-family":c,display:"inline-block",margin:"0px"}),r.getImages().image1&&(s.image1={width:"100%",padding:"0px",margin:"0px","line-height":"0px"}),r.getImages().image1&&(s.image2=s.image1),s.title={color:r.getTitle().getTextColorAsRGB(),"text-align":"center",padding:"10px","font-size":"x-large","font-family":c},s.message={color:r.getMessage().getTextColorAsRGB(),padding:"12px","padding-left":"30px","padding-right":"30px","font-size":"13px","text-align":"left","font-family":c,"min-height":"72px"},s.background={padding:"0px","background-color":r.getBackgroundColorAsRGB(),width:"296px",position:"fixed",top:"30px",border:"1px solid #666666","box-shadow":"0px 5px 5px 0px rgba(0, 0, 0, 0.5)",left:($(window).width()-296)/2+"px","z-index":99999,cursor:"default"},l=!0}else if(A==a&&R.includes(o))s.button1={color:r.getMessage().getTextColorAsRGB(),top:"0px",left:"0px",width:"100%",height:"100%","min-height":"60px",position:"absolute",padding:"12px","font-size":"normal","text-align":"left","font-family":c},s.button2={display:"none"},s.image1={width:"60px",height:"60px",position:"absolute",left:"13px",top:"13px"},s.image2={display:"none"},s.close_button={width:"16px",height:"16px","vertical-align":"top",align:"right",position:"absolute",right:"3px",top:"3px","font-weight":"bold",color:r.getButtons().close_button.getTextColorAsRGB()},s.title={display:"none"},s.message={color:r.getMessage().getTextColorAsRGB(),bottom:"0px","min-height":"60px",position:"relative","padding-top":"32px",padding:"24px","padding-left":"99px","font-size":"13px","text-align":"left","font-family":c},s.background={padding:"0px","background-color":r.getButtons().button1.getBackgroundColorAsRGB(),position:"fixed",bottom:"10px",right:"10px",width:"360px","min-height":"86px","box-shadow":"0px 5px 5px 0px rgba(0, 0, 0, 0.5)","z-index":99999,cursor:"default"},s.backgroundPre={bottom:"-400px"},s.backgroundPost={bottom:"10px"},s.backgroundClose={opacity:0},l=!1;else{var h=r.getButtons().button1;h&&(s.button1={"background-color":h.getBackgroundColorAsRGB(),color:h.getTextColorAsRGB(),"border-collapse":"collapse",border:"1px solid #545e6b","border-left":"1px solid #545e6b",width:"99%",height:"42px","line-height":"34px",padding:"3px","font-size":"16px","text-align":"center","font-family":c}),h=r.getButtons().button2,h&&(s.button2=s.button1),r.getImages().image1&&(s.image1={width:"100%",padding:"0px",margin:"0px","line-height":"0px"}),r.getImages().image1&&(s.image2=s.image1),s.title={color:r.getTitle().getTextColorAsRGB(),padding:"10px","font-size":"x-large","font-family":c},s.message={color:r.getMessage().getTextColorAsRGB(),padding:"10px","font-size":"normal","text-align":"left","font-family":c},s.background={padding:"0px","background-color":r.getBackgroundColorAsRGB(),"z-index":99999}}}var f=$("<div />",{}),m=$("<div />").css(s.modalPanel),S=function(){m.css({width:$(document).width(),height:$(document).height()})};$(window).bind("resize",S),l&&($("body").append(m),m.css({"z-index":99998}),m.animate(s.modalPanel,500));var T=function(){$("body").unbind("resize",S),f.remove(),m.remove(),v("hide",!0,"In-app Dialog is Closing")},B=function(e){m.animate(s.backgroundClose,500),f.animate(s.backgroundClose,500,T),e&&p(e,r.getButtons()),console.log("SUCCESS")};f.css(s.background);r.getImages().image1&&f.append($("<img />",{src:r.getImages().image1.getImageUrl()}).css(s.image1)),r.getImages().image2&&f.append($("<img />",{src:r.getImages().image2.getImageUrl()}).css(s.image2)),r.getTitle()&&f.append($("<div />",{text:r.getTitle().getText()}).css(s.title)),r.getMessage().getText()&&f.append($("<div />",{text:r.getMessage().getText()}).css(s.message)),r.getButtons().button1&&f.append($("<div />",{text:r.getButtons().button1.getText()}).css(s.button1).on("click",function(){B("button1")})),r.getButtons().button2&&f.append($("<div />",{text:r.getButtons().button2.getText()}).css(s.button2).on("click",function(){B("button2")})),r.getButtons().close_button&&f.append($("<div />",{html:"&times;"}).css(s.close_button).on("click",function(){B("close_button")})),f.css(s.backgroundPre);var M=new KahunaEventBuilder("k_iam_displayed");M.addProperty(E,e().mLastInAppMessageReceived.getTrackingId()),M.addProperty(C,r.getId()),Kahuna.track(M.build()),$("body").append(f),f.animate(s.backgroundPost,u),f.animate(s.backgroundPost,u),v("show",!0,"In-app is Showing"),b={hide:T}}return n.getRetryAttempts()<=0?void(e().mLastInAppMessageReceived==n&&(e().mLastInAppMessageReceived=null)):(n.decrementRetryAttempt(),void i())}function i(t,n){if(!t||0==Object.keys(t).length)return void(Kahuna.getDebugModeEnabled()&&Kahuna.logDebug("Aborting attempt to process empty or null in app message "+t));if(Kahuna.logDebug("Processing received Rich In App Message: "+JSON.stringify(t)),t)if(message=r.parseRichInAppMessage(t),message&&l(message)){if(null!=e().mLastInAppMessageReceived)return Kahuna.logDebug("Already processing another in app message, closing the old and opening the new."),d(e().foregroundActivity,!1),e().mLastInAppMessageReceived=null,void i(t,n);e().mLastInAppMessageReceived=message,u(message,e().foregroundActivity),"function"==typeof n&&(Kahuna.logDebug("Calling callback"),n())}else Kahuna.logDebug("Unable to display Rich In App Message with missing or malformed data."),h(message,"Missing or Malformed data.")}function o(t){Kahuna.logDebug("hostActivityStarted"),null!=e().activityRenderedOn&&(d(e().activityRenderedOn,!1),e().activityRenderedOn=null),null!=e().mLastInAppMessageReceived&&u(e().mLastInAppMessageReceived,t),e().foregroundActivity=t}function s(t){e().activityRenderedOn==t&&d(t,!1),e().foregroundActivity==t&&(e().foregroundActivity=null)}function u(t,n){null!=t&&(t.getState()==r.State.UNPREPARED?(t.setPreparing(),c(t)):t.getState()==r.State.PREPARED&&null!=n&&e().renderInAppMessage(n,t))}function l(e){if(null==e||0==Object.keys(e.getTemplates()).length)return!1;var t=new Date/1e3,n=e.getExpireTime();if(n>0&&t>n)return Kahuna.getDebugModeEnabled()&&Kahuna.logDebug("Unable to display expired Rich In App Message."),h(e,"Message expired."),!1;if(null!=e.getRestrictedCredentials()&&!KahunaUtils.getHaveCredentialsInRestrictionMap(e.getRestrictedCredentials()))return h(e,"Bad credentials."),!1;for(var i=e.getTemplates(),r=0;r<i.length;r++){var a=i[r];if(a&&!g(a,a.getType(),a.getSubtype())&&!g(a,a.getType(),a.getFallbackSubtype())&&!g(a,y,1))return Kahuna.getDebugModeEnabled()&&Kahuna.logDebug("Unable to display Rich In App Message with missing or malformed data."),h(e,"Missing or Malformed data."),!1}return!0}function g(e,t,n){if(null==e||""==t||!I.includes(t))return!1;if(k==t){if(!_.includes(n))return!1;if(!e.getTitle()||!e.getMessage()||0==Object.keys(e.getImages()).length||0==Object.keys(e.getButtons()).length)return!1;if(!e.getButtons().button1||!e.getButtons().button2)return!1;switch(n){case 1:if(!e.getImages().image1)return!1;break;case 2:if(!e.getImages().image1||!e.getImages().image2)return!1;break;default:return!1}}else if(x==t){if(!w.includes(n))return!1;if(!e.getTitle()||!e.getMessage()||0==Object.keys(e.getImages()).length||0==Object.keys(e.getButtons()).length)return!1;if(!e.getImages().image1)return!1;switch(n){case 1:if(!e.getButtons().button1||!e.getButtons().button2)return!1;break;default:return!1}}else if(A==t){if(!R.includes(n))return!1;if(!e.getMessage()||0==Object.keys(e.getImages()).length||0==Object.keys(e.getButtons()).length)return!1;if(!e.getImages().image1)return!1;if(null==e.getButtons().button1||null==e.getButtons().close_button)return!1}else{if(!e.getMessage()||0==Object.keys(e.getButtons()).length)return!1;if(!e.getButtons().button1)return!1}return!0}function c(t){var n;this.inAppMessage=t,n=t,n.setPrepared(),null!=e().foregroundActivity?e().renderInAppMessage(e().foregroundActivity,n):(n.setUnprepared(),h(n,"Failed to download images."),e().mLastInAppMessageReceived==n&&(e().mLastInAppMessageReceived=null))}function d(t,n){if(null!=t&&null!=b){try{b.hide()}catch(i){Kahuna.logError("Caught exception dismissing In App Message dialog: "+i.message)}b=null,n&&(e().mLastInAppMessageReceived=null)}}function p(t,n){try{var i=n[t];if(null!=i){var r=i.getAction();if(r&&Object.keys(r).length>0&&"url"==r){var a=i.getActionValue();if(a){window.open(a)}}if(null!=e().mLastInAppMessageReceived&&e().mLastInAppMessageReceived.getTemplates().length>0){Kahuna.logDebug("Button Clicked");var o=e().mLastInAppMessageReceived.getTemplates()[0],s=new KahunaEventBuilder("k_iam_clicked");s.addProperty("trackingId",e().mLastInAppMessageReceived.getTrackingId()),s.addProperty("templateId",o.getId()),s.addProperty("button",t),Kahuna.track(s.build()),Kahuna.flushEvents({fi:"k_iam_clicked"})}}}catch(u){Kahuna.logDebug("Caught exception trying to open Url: "+u.message)}d(e().foregroundActivity,!0)}function h(e,t){var n=new KahunaEventBuilder("k_iam_not_displayed");if(n.addProperty(B,t),e&&(n.addProperty(E,e.getTrackingId()),e.getTemplates().length>0)){var i=e.getTemplates()[0];n.addProperty(C,i.getId())}Kahuna.track(n.build())}function f(e,t){var n=["show","click","hide"];return n.includes(e)?"function"!=typeof t?(logDebug("Invalid Event Handler Callback"),!1):(K[e].push(t),Kahuna.logDebug("registering event handler to "+e),!0):(logDebug("Invalid Event Handler Type"),!1)}function v(e,t,n){var i=K[e];for(var r in i)i[r](e,t,n)}function m(){K={show:[],hide:[],click:[]}}var b,y="system",k="fullscreen",x="modal",A="slider",I=[y,k,x,A],_=[1,2],w=[1],R=[1],S=86400,E="trackingId",C="templateId",T="button",B="reason",M=null,O=null,K={show:[],hide:[],click:[]};return{DEFAULT_EXPIRY_SECONDS:S,TRACKINGID_PROPERTY_KEY:E,TEMPLATEID_PROPERTY_KEY:C,BUTTON_PROPERTY_KEY:T,REASON_PROPERTY_KEY:B,setContext:function(e){t(e)},handleRichInAppMessageResponse:function(e){return i(e)},renderInAppMessage:function(e,t){return n(e,t)},closeInAppMessage:function(){return d(e().foregroundActivity,!0)},hostActivityStarted:function(e){o(e)},hostActivityStopped:function(e){s(e)},addEventHandler:function(e,t){f(e,t)},clearEventHandlers:function(){m()}}}();Kahuna.RichInAppMessage=r,Kahuna.RichInAppMessageButton=i,Kahuna.RichInAppMessageText=e,Kahuna.RichInAppMessageImage=n,Kahuna.RichInAppMessageTemplate=t,Kahuna.RichInAppMessageManager=a,Kahuna.RichInAppMessageManager.hostActivityStarted(window)}();